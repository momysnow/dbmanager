<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBManager Enterprise</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="brand">
                <i class="fa-solid fa-server"></i> DBManager
            </div>

            <a href="#" class="nav-link active" data-page="dashboard" onclick="router.navigate('dashboard')">
                <i class="fa-solid fa-chart-pie"></i> Dashboard
            </a>
            <a href="#" class="nav-link" data-page="databases" onclick="router.navigate('databases')">
                <i class="fa-solid fa-database"></i> Databases
            </a>
            <a href="#" class="nav-link" data-page="backups" onclick="router.navigate('backups')">
                <i class="fa-solid fa-clock-rotate-left"></i> Backups
            </a>
            <a href="#" class="nav-link" data-page="schedules" onclick="router.navigate('schedules')">
                <i class="fa-solid fa-calendar-days"></i> Schedules
            </a>
            <a href="#" class="nav-link" data-page="s3" onclick="router.navigate('s3')">
                <i class="fa-brands fa-aws"></i> S3 Storage
            </a>
            <a href="#" class="nav-link" data-page="settings" onclick="router.navigate('settings')">
                <i class="fa-solid fa-gear"></i> Settings
            </a>

            <div style="margin-top: auto;">
                <a href="#" class="nav-link"
                    onclick="localStorage.removeItem('access_token'); window.location.reload();">
                    <i class="fa-solid fa-right-from-bracket"></i> Logout
                </a>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content" id="app">
            <!-- Dynamic Content Injected Here -->
            <div style="display:flex; height:100%; align-items:center; justify-content:center;">
                <div class="spinner"></div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="add-db-modal">
        <div class="modal">
            <h2 style="margin-top: 0;">Add Database</h2>
            <form id="add-db-form" onsubmit="api.addDatabase(event)">
                <label>Friendly Name</label>
                <input type="text" name="name" required placeholder="My Production DB">

                <label>Provider</label>
                <select name="provider">
                    <option value="postgres">PostgreSQL</option>
                    <option value="mysql">MySQL</option>
                    <option value="mariadb">MariaDB</option>
                    <option value="sqlserver">SQL Server</option>
                    <option value="mongodb">MongoDB</option>
                </select>

                <div style="display:grid; grid-template-columns: 2fr 1fr; gap:10px;">
                    <div>
                        <label>Host</label>
                        <input type="text" name="host" required placeholder="localhost">
                    </div>
                    <div>
                        <label>Port</label>
                        <input type="number" name="port" required value="5432">
                    </div>
                </div>

                <label>Database Name</label>
                <input type="text" name="database" required placeholder="mydb">

                <label>User</label>
                <input type="text" name="user" required placeholder="postgres">

                <label>Password</label>
                <input type="password" name="password" required>

                <div style="margin: 20px 0; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;">
                    <label style="color:var(--primary); margin-bottom:10px; display:block;">Backup Settings</label>

                    <label>Local Retention (Count)</label>
                    <input type="number" name="retention" value="7" placeholder="0 = infinite">

                    <div style="display:flex; align-items:center; gap:10px; margin-top:15px;">
                        <input type="checkbox" name="s3_enabled" style="width:auto; margin:0;">
                        <label style="margin:0;">Enable S3 Upload</label>
                    </div>

                    <label style="margin-top:10px;">S3 Bucket</label>
                    <select name="s3_bucket_id">
                        <option value="">Select Bucket...</option>
                    </select>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn" style="background: rgba(255,255,255,0.1);"
                        onclick="ui.modals.addDb.close()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Database</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Progress Modal -->
    <div class="modal-overlay" id="task-modal">
        <div class="modal" style="width: 600px;">
            <h2 id="task-title" style="margin-top: 0;">Task in Progress</h2>
            <div style="margin: 30px 0;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span id="task-step">Initializing...</span>
                    <span id="task-percent">0%</span>
                </div>
                <div style="background: rgba(255,255,255,0.1); height: 8px; border-radius: 4px; overflow: hidden;">
                    <div id="task-bar"
                        style="background: var(--primary); width: 0%; height: 100%; transition: width 0.3s; transition-timing-function: linear;">
                    </div>
                </div>
                <div id="task-message" style="margin-top: 10px; color: var(--text-secondary); font-size: 14px;">
                    Waiting for server...
                </div>
            </div>
            <div style="display: flex; justify-content: flex-end;">
                <button class="btn" id="task-close-btn" onclick="ui.modals.task.close()"
                    style="display: none;">Close</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/static/js/app.js"></script>
</body>

</html>